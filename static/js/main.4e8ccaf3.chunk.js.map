{"version":3,"sources":["components/ImageDisplay.js","components/Convolution.js","App.js","index.js"],"names":["index","x","y","width","floor","Math","convolve","img","filter","scl","r","b","g","dim2","dim","i","j","filterIndex","filterValue","values","pixelIndex","data","ImageDisplay","props","displayRef","useRef","convoledRef","fileRef","downloadRef","useState","image","setImage","useEffect","ctx","current","getContext","otherCtx","drawImage","imgPixels","getImageData","putImageData","newImage","ImageData","height","scale","className","ref","id","type","name","onChange","e","target","files","length","file","fileReader","FileReader","onload","Image","src","result","readAsDataURL","accept","onClick","click","toDataURL","href","download","Convolution","Array","fill","setFilter","setScale","onInput","style","gridTemplateColumns","map","n","value","key","temp","Number","changeHandler","htmlFor","App","setDim","selectRef","inputHandler","useCallback","f","s","min","max","sign","presetFilter","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4e8ccaf3.chunk.js","sourcesContent":["import React, {useRef, useState, useEffect} from 'react'\r\n\r\nimport \"./ImageDisplay.css\"\r\n\r\nconst index = (x, y, width) => (x+y*width)*4\r\n\r\nconst floor = Math.floor\r\n\r\nconst convolve = (img, filter, scl, x, y) => {\r\n    let r = 0, b = 0, g = 0\r\n    const dim2 = floor(filter.dim / 2)\r\n    for (let i = -dim2; i <= dim2; i++){\r\n        for (let j = -dim2; j <= dim2; j++){\r\n            const filterIndex = floor(index(i+dim2, j+dim2, filter.dim)/4)\r\n            const filterValue = filter.values[filterIndex]/scl\r\n            const pixelIndex = index(x+i, y+j, 500)\r\n            r += img.data[pixelIndex] * filterValue\r\n            g += img.data[pixelIndex + 1] * filterValue\r\n            b += img.data[pixelIndex + 2] * filterValue\r\n        }\r\n    }\r\n    return [r, g, b]\r\n}\r\n\r\nconst ImageDisplay = props => {\r\n    const displayRef = useRef()\r\n    const convoledRef = useRef()\r\n    const fileRef = useRef()\r\n    const downloadRef = useRef()\r\n    const [image, setImage] = useState()\r\n\r\n    const pickHandler = e => {\r\n        if (e.target.files && e.target.files.length === 1) {\r\n            const file = e.target.files[0];\r\n            const fileReader = new FileReader()\r\n            fileReader.onload = () => {\r\n                const img = new Image()\r\n                img.src = fileReader.result\r\n                setImage(img)\r\n            }\r\n            fileReader.readAsDataURL(file)\r\n        } \r\n    }\r\n\r\n    useEffect(() => {\r\n        if(image && props.filter){\r\n            const ctx = displayRef.current.getContext(\"2d\")\r\n            const otherCtx = convoledRef.current.getContext(\"2d\")\r\n            ctx.drawImage(image, 0, 0, 500, 500)\r\n            let imgPixels = ctx.getImageData(0, 0, 500, 500);\r\n            const height = 500, width = 500\r\n            ctx.putImageData(imgPixels, 0, 0);\r\n            const newImage = new ImageData(width, height)\r\n            for(let i = 1; i < width-1; i++){\r\n                for(let j = 1; j < height-1; j++){\r\n                    const [r, g, b] = convolve(imgPixels, props.filter, props.scale, i, j)\r\n                    const pixelIndex = index(i, j, width)\r\n                    newImage.data[pixelIndex] = r\r\n                    newImage.data[pixelIndex+1] = g\r\n                    newImage.data[pixelIndex+2] = b\r\n                    newImage.data[pixelIndex+3] = 255\r\n                }\r\n            }\r\n            otherCtx.putImageData(newImage, 0, 0)\r\n        }\r\n\r\n    }, [props.filter, props.scale, image])\r\n\r\n    const fileClickHandler = () => {\r\n        fileRef.current.click()\r\n    }\r\n\r\n    const downloadHandler = e => {\r\n        const ctx = convoledRef.current\r\n        const img = ctx.toDataURL(\"image/png\")\r\n        downloadRef.current.href = img\r\n    }\r\n\r\n    return (\r\n        <div className=\"image-display\">\r\n            <h2>Original</h2>\r\n            <h2>Convolved</h2>\r\n            <canvas ref={displayRef} height=\"500\" width=\"500\" id=\"display\"></canvas>\r\n            \r\n            <canvas ref={convoledRef} height=\"500\" width=\"500\" id=\"convolved-display\"></canvas>\r\n            <input ref={fileRef} type=\"file\" id=\"img\" name=\"img\" onChange={pickHandler} accept=\"image/png, image/jpeg\"/>\r\n            <button className=\"image-button\" onClick={fileClickHandler}>Choose Image</button>\r\n            <a ref={downloadRef} onClick={downloadHandler} id=\"download\" className=\"image-button\" download=\"convolved.png\" href=\"f\">Download Convolved Image</a>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ImageDisplay","import React, { useState, useEffect } from 'react'\r\n\r\nimport \"./Convolution.css\"\r\n\r\nconst Convolution = props => {\r\n    const dim = props.dim\r\n    const [filter, setFilter] = useState({values: Array(dim*dim).fill(1), dim: dim})\r\n    const [scale, setScale] = useState(1)\r\n\r\n    useEffect(() => {\r\n        props.onInput(filter, scale)\r\n    }, [filter.dim])\r\n\r\n    useEffect(() => {\r\n        setFilter(props.filter)\r\n        setScale(props.scale)\r\n\r\n    }, [props.filter, props.scale])\r\n\r\n    useEffect(() => {\r\n        const dim = props.dim\r\n        setFilter({ values: Array(dim * dim).fill(1), dim: dim })\r\n    }, [props.dim])\r\n    \r\n    const changeHandler = (e, i) => {\r\n        const temp = {...filter}\r\n        temp.values[i] = Number(e.target.value)\r\n        setFilter(temp)\r\n        props.onInput(temp, scale)\r\n    }\r\n\r\n    const scaleChangeHandler = e => {\r\n        setScale(Number(e.target.value))\r\n        props.onInput(filter, Number(e.target.value))\r\n    }\r\n\r\n    return (\r\n        <div className=\"convolution\">\r\n            <h2>Filter</h2>\r\n            <div className=\"convolution-container\" style={{gridTemplateColumns: `repeat(${filter.dim}, 1fr)`, width: filter.dim*50, height: filter.dim*50}}>\r\n            {filter.values.map((n,i) => (\r\n                <input className=\"filter-number\" value={n} key={i} onChange={e => changeHandler(e, i)} type=\"number\"/>\r\n            ))}\r\n            </div>\r\n            <div className=\"filter-scale\">\r\n            <label htmlFor=\"scale\">Scale</label>\r\n            <input name=\"scale\" value={scale} onChange={scaleChangeHandler} type=\"number\"/>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Convolution","import React, { useState, useCallback, useRef } from 'react';\nimport './App.css';\nimport ImageDisplay from './components/ImageDisplay';\nimport Convolution from './components/Convolution';\n\nfunction App() {\n  const [dim, setDim] = useState(3)\n  const [filter, setFilter] = useState()\n  const [scale, setScale] = useState()\n  const selectRef = useRef()\n\n  const inputHandler = useCallback((f, s) => {\n    setFilter(f)\n    setScale(s)\n  }, [])\n\n  const changeHandler = e => {\n    const n = Number(e.target.value)\n    if(n %2 === 0){\n      setDim(n+Math.sign(n-dim))\n    }else{\n      setDim(n)\n    }\n  }\n\n  const selectChangeHandler = () => {\n    let presetFilter\n    switch(selectRef.current.value){\n      case \"3x3 horz edge\":\n        presetFilter = {\n          values: [-5, -5, -5, 5, 5, 5, 0, 0, 0], \n          dim: 3\n        }\n        setFilter(presetFilter)\n        setDim(3)\n        setScale(1)\n      break;\n      case \"3x3 vert edge\":\n        presetFilter = {\n          values: [-5, 5, 0, -5, 5, 0, -5, 5, 0],\n          dim: 3\n        }\n        setFilter(presetFilter)\n        setDim(3)\n        setScale(1)\n      break;\n      case \"3x3 gen edge\":\n        presetFilter = {\n          values: [-2, -2, -2, -2, 16, -2, -2, -2, -2],\n          dim: 3\n        }\n        setFilter(presetFilter)\n        setDim(3)\n        setScale(1)\n      break;\n      case \"5x5 blur\":\n        presetFilter = {\n          values: Array(25).fill(1),\n          dim: 5\n        }\n        setFilter(presetFilter)\n        setDim(5)\n        setScale(25)\n      break;\n      case \"5x5 gauss blur\":\n        presetFilter = {\n          values: [1, 4, 6, 4, 1, 4, 16, 24, 16, 4, 6, 24, 36, 24, 6, 4, 16, 24, 16, 4, 1, 4, 6, 4, 1],\n          dim: 5\n        }\n        setFilter(presetFilter)\n        setDim(5)\n        setScale(256)\n      break;\n      default:\n        break;\n    }\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"dimension\"><h1>Image Convolver</h1></div>\n     <Convolution dim={dim} filter={filter} scale={scale} onInput={inputHandler}/>\n     <ImageDisplay filter={filter} scale={scale}/>\n      <div className=\"\">\n        <label htmlFor=\"dimension\">Filter Size</label>\n        <input min=\"3\" max=\"7\" onChange={changeHandler} value={dim} type=\"number\" id=\"dimension\"/>\n      </div>\n      <div>\n        <label htmlFor=\"presets\">Filter Presets</label>\n        <select ref={selectRef} onChange={selectChangeHandler} id=\"presets\">\n          <option value=\"3x3 horz edge\">3x3 Horizontal Edge Detection</option>\n          <option value=\"3x3 vert edge\">3x3 Vertical Edge Detection</option>\n          <option value=\"3x3 gen edge\">3x3 General Edge Detection</option>\n          <option value=\"5x5 blur\">5x5 blur</option>\n          <option value=\"5x5 gauss blur\">5x5 Gaussian blur</option>\n          {/* <option value=\"5x5\">5x5</option> */}\n        </select>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}